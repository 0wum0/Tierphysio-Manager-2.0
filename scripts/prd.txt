PROJECT: Tierphysio Manager 2.0
DESCRIPTION:
A modern, full-stack web application for managing a veterinary physiotherapy practice.
Technologies: PHP 8.3, MySQL, Twig, TailwindCSS, Alpine.js, Anime.js.
Goal: 100% functional practice manager â€” not a demo. All features must operate with real DB data.

STRUCTURE OVERVIEW:
Root Folder (/workspace/)
â”‚
â”œâ”€â”€ /api/                 â†’ JSON endpoints for AJAX calls
â”‚     â”œâ”€â”€ patients.php    â†’ CRUD operations for patients
â”‚     â”œâ”€â”€ owners.php      â†’ CRUD operations for owners
â”‚     â”œâ”€â”€ appointments.php â†’ CRUD operations for appointments
â”‚     â”œâ”€â”€ treatments.php  â†’ CRUD operations for treatments
â”‚     â”œâ”€â”€ invoices.php    â†’ CRUD operations for invoices
â”‚     â”œâ”€â”€ notes.php       â†’ CRUD operations for notes
â”‚     â”œâ”€â”€ search.php      â†’ Global search endpoint
â”‚     â”œâ”€â”€ integrity_json.php â†’ API validation & testing
â”‚     â”œâ”€â”€ settings.php    â†’ Application settings management
â”‚     â”œâ”€â”€ stats.php       â†’ Statistics & analytics data
â”‚     â”œâ”€â”€ backup.php      â†’ Database backup management
â”‚     â”œâ”€â”€ users.php       â†’ User management
â”‚     â””â”€â”€ _bootstrap.php  â†’ Common API initialization
â”‚
â”œâ”€â”€ /includes/            â†’ PHP logic, database, authentication, template renderer
â”‚     â”œâ”€â”€ db.php          â†’ Database connection & PDO wrapper
â”‚     â”œâ”€â”€ Database.php    â†’ Database class implementation
â”‚     â”œâ”€â”€ Auth.php        â†’ Authentication class
â”‚     â”œâ”€â”€ SimpleAuth.php  â†’ Simple auth implementation
â”‚     â”œâ”€â”€ StandaloneAuth.php â†’ Standalone auth for testing
â”‚     â”œâ”€â”€ Template.php    â†’ Template engine class
â”‚     â”œâ”€â”€ SimpleTemplate.php â†’ Simple template implementation
â”‚     â”œâ”€â”€ template.php    â†’ Template helper functions
â”‚     â”œâ”€â”€ csrf.php        â†’ CSRF protection
â”‚     â”œâ”€â”€ response.php    â†’ JSON response helpers
â”‚     â”œâ”€â”€ functions.php   â†’ Common helper functions
â”‚     â”œâ”€â”€ version.php     â†’ Version tracking
â”‚     â””â”€â”€ auto_migrate_documents.php â†’ Document migration helper
â”‚
â”œâ”€â”€ /templates/           â†’ Twig templates
â”‚     â”œâ”€â”€ /layouts/
â”‚     â”‚     â”œâ”€â”€ base.twig â†’ Base layout with header/footer
â”‚     â”‚     â””â”€â”€ modal.twig â†’ Modal layout template
â”‚     â”œâ”€â”€ /partials/
â”‚     â”‚     â”œâ”€â”€ header.twig â†’ Header with navigation & search
â”‚     â”‚     â”œâ”€â”€ sidebar.twig â†’ Sidebar navigation
â”‚     â”‚     â”œâ”€â”€ footer.twig â†’ Footer with copyright
â”‚     â”‚     â””â”€â”€ search.twig â†’ Search component
â”‚     â”œâ”€â”€ /pages/
â”‚     â”‚     â”œâ”€â”€ dashboard.twig â†’ Dashboard with KPIs & charts
â”‚     â”‚     â”œâ”€â”€ patients.twig â†’ Patient list & management
â”‚     â”‚     â”œâ”€â”€ owners.twig â†’ Owner list & management
â”‚     â”‚     â”œâ”€â”€ appointments.twig â†’ Appointment calendar & list
â”‚     â”‚     â”œâ”€â”€ treatments.twig â†’ Treatment records
â”‚     â”‚     â”œâ”€â”€ invoices.twig â†’ Invoice management
â”‚     â”‚     â”œâ”€â”€ notes.twig â†’ Notes management
â”‚     â”‚     â”œâ”€â”€ admin.twig â†’ Admin panel
â”‚     â”‚     â”œâ”€â”€ login.twig â†’ Login page
â”‚     â”‚     â”œâ”€â”€ settings.twig â†’ Settings page
â”‚     â”‚     â””â”€â”€ error.twig â†’ Error page
â”‚
â”œâ”€â”€ /public/              â†’ Frontend pages and assets (entry points)
â”‚     â”œâ”€â”€ index.php       â†’ Main entry point
â”‚     â”œâ”€â”€ dashboard.php   â†’ Dashboard page
â”‚     â”œâ”€â”€ patients.php    â†’ Patients page
â”‚     â”œâ”€â”€ owners.php      â†’ Owners page
â”‚     â”œâ”€â”€ appointments.php â†’ Appointments page
â”‚     â”œâ”€â”€ treatments.php  â†’ Treatments page
â”‚     â”œâ”€â”€ invoices.php    â†’ Invoices page
â”‚     â”œâ”€â”€ notes.php       â†’ Notes page
â”‚     â”œâ”€â”€ admin.php       â†’ Admin panel
â”‚     â”œâ”€â”€ settings.php    â†’ Settings page
â”‚     â”œâ”€â”€ login.php       â†’ Login page
â”‚     â”œâ”€â”€ logout.php      â†’ Logout handler
â”‚     â”œâ”€â”€ js/
â”‚     â”‚     â”œâ”€â”€ app.js    â†’ Main JavaScript application
â”‚     â”‚     â”œâ”€â”€ api.js    â†’ API communication layer
â”‚     â”‚     â”œâ”€â”€ patients.js â†’ Patient-specific JS
â”‚     â”‚     â”œâ”€â”€ owners.js â†’ Owner-specific JS
â”‚     â”‚     â”œâ”€â”€ modals.js â†’ Modal management
â”‚     â”‚     â””â”€â”€ admin.js  â†’ Admin panel JS
â”‚     â”œâ”€â”€ img/
â”‚     â”‚     â””â”€â”€ patient_placeholder.svg â†’ Placeholder images
â”‚     â””â”€â”€ uploads/
â”‚           â”œâ”€â”€ patient_photos/ â†’ Patient photo uploads
â”‚           â””â”€â”€ documents/ â†’ Document uploads
â”‚
â”œâ”€â”€ /installer/           â†’ Installer + migrations + update scripts
â”‚     â””â”€â”€ index.php       â†’ Installation wizard
â”‚
â”œâ”€â”€ /migrations/          â†’ Versioned DB patches
â”‚     â”œâ”€â”€ 001_initial_schema.sql â†’ Initial database schema
â”‚     â”œâ”€â”€ 002_create_tp_tables.sql â†’ Tierphysio specific tables
â”‚     â”œâ”€â”€ 003_default_settings.sql â†’ Default settings
â”‚     â””â”€â”€ 004_patient_tabs.sql â†’ Patient tabs structure
â”‚
â”œâ”€â”€ /integrity/           â†’ Automatic integrity & JSON test tools
â”‚     â”œâ”€â”€ db_check.php    â†’ Database integrity check
â”‚     â”œâ”€â”€ http_smoke.php  â†’ HTTP endpoint testing
â”‚     â””â”€â”€ test_patients_api.php â†’ Patient API testing
â”‚
â”œâ”€â”€ /backups/             â†’ Auto-generated backups
â”‚
â”œâ”€â”€ /data/                â†’ Database files
â”‚     â”œâ”€â”€ tierphysio.db   â†’ SQLite database
â”‚     â””â”€â”€ init_db.sql     â†’ Database initialization
â”‚
â”œâ”€â”€ /logs/                â†’ Application logs
â”‚     â””â”€â”€ api.log         â†’ API request/response logs
â”‚
â”œâ”€â”€ /scripts/             â†’ Project management & documentation
â”‚     â”œâ”€â”€ prd.txt         â†’ Product requirements document
â”‚     â”œâ”€â”€ tasks.json      â†’ Current task list
â”‚     â””â”€â”€ cursor-rules.md â†’ Development guidelines
â”‚
â””â”€â”€ /setup/               â†’ Setup & test data
      â””â”€â”€ test_data.sql   â†’ Test data for development

---

CORE FEATURES:

1ï¸âƒ£ PATIENTENVERWALTUNG:
   - CRUD (create/read/update/delete) operations
   - Modal view with tabs: Befunde, Notizen, Dokumente, Rechnungen
   - Photo upload (stored in /uploads/patient_photos/)
   - Linked owner data shown on each card
   - Live status: invoice open/paid, next appointment date
   - Search & filter capabilities
   - Export functionality

2ï¸âƒ£ BESITZERVERWALTUNG:
   - CRUD operations
   - Linked patients display
   - Auto-numbering for customer_number
   - Invoice overview per owner
   - Contact information management
   - Emergency contact details

3ï¸âƒ£ TERMINVERWALTUNG:
   - Create/edit/cancel appointments
   - Linked to patient and therapist
   - Calendar + list view
   - Upcoming appointment visible on patient card
   - Recurring appointment support
   - Reminder system
   - Status tracking (scheduled, confirmed, completed, cancelled)

4ï¸âƒ£ BEHANDLUNGEN:
   - Diagnosis, notes, methods, pain scale
   - Linked to appointments and patients
   - Treatment history tracking
   - Progress monitoring
   - PDF export for reports
   - Template support for common treatments

5ï¸âƒ£ RECHNUNGEN:
   - Automatic invoice number generation
   - Status tracking (draft, sent, paid, overdue)
   - Linked to patients and owners
   - Chart.js revenue statistics
   - Payment tracking
   - Export to PDF
   - Email integration

6ï¸âƒ£ NOTIZEN & DOKUMENTE:
   - General, medical, reminder notes
   - File upload (PDF, images, documents)
   - Linked by patient_id or appointment_id
   - Inline preview capabilities
   - Version tracking
   - Search within documents

7ï¸âƒ£ GLOBALE SUCHE:
   - Topbar search (Alpine.js)
   - Dropdown results (patients + owners)
   - Opens patient modal on click
   - Responsive, full-width dropdown
   - Real-time search results
   - Search history

8ï¸âƒ£ DASHBOARD:
   - Displays KPIs: Total patients, invoices, revenue
   - Chart.js graphs (weekly/monthly revenue)
   - Recent appointments list
   - Upcoming appointments
   - Outstanding invoices
   - Quick actions panel
   - Activity feed

9ï¸âƒ£ DESIGN & UX:
   - TailwindCSS + Alpine.js
   - Dark/Light theme toggle
   - Footer centered under content
   - Modals fixed-centered on screen
   - Tabs scrollable inside modal only
   - Smooth transitions via Anime.js
   - Responsive design (mobile-first)
   - Accessibility compliance (WCAG 2.1)

ğŸ”Ÿ SICHERHEIT:
   - User authentication system
   - Role-based access control
   - CSRF protection
   - Input validation
   - SQL injection prevention
   - XSS protection
   - Secure file uploads
   - Session management
   - API rate limiting

---

DATABASE SCHEMA:

patients:
- id (INTEGER PRIMARY KEY)
- name (VARCHAR)
- species (VARCHAR)
- breed (VARCHAR)
- age (INTEGER)
- owner_id (INTEGER FOREIGN KEY)
- photo (TEXT)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

owners:
- id (INTEGER PRIMARY KEY)
- customer_number (VARCHAR UNIQUE)
- name (VARCHAR)
- email (VARCHAR)
- phone (VARCHAR)
- address (TEXT)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

appointments:
- id (INTEGER PRIMARY KEY)
- patient_id (INTEGER FOREIGN KEY)
- therapist_id (INTEGER FOREIGN KEY)
- date (DATE)
- time (TIME)
- duration (INTEGER)
- status (VARCHAR)
- notes (TEXT)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

treatments:
- id (INTEGER PRIMARY KEY)
- appointment_id (INTEGER FOREIGN KEY)
- patient_id (INTEGER FOREIGN KEY)
- diagnosis (TEXT)
- methods (TEXT)
- pain_scale (INTEGER)
- notes (TEXT)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

invoices:
- id (INTEGER PRIMARY KEY)
- invoice_number (VARCHAR UNIQUE)
- patient_id (INTEGER FOREIGN KEY)
- owner_id (INTEGER FOREIGN KEY)
- amount (DECIMAL)
- status (VARCHAR)
- due_date (DATE)
- paid_date (DATE)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

notes:
- id (INTEGER PRIMARY KEY)
- patient_id (INTEGER FOREIGN KEY)
- appointment_id (INTEGER FOREIGN KEY)
- type (VARCHAR)
- content (TEXT)
- created_by (INTEGER FOREIGN KEY)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

documents:
- id (INTEGER PRIMARY KEY)
- patient_id (INTEGER FOREIGN KEY)
- title (VARCHAR)
- filename (VARCHAR)
- file_path (TEXT)
- file_size (INTEGER)
- uploaded_by (INTEGER FOREIGN KEY)
- created_at (TIMESTAMP)

users:
- id (INTEGER PRIMARY KEY)
- username (VARCHAR UNIQUE)
- email (VARCHAR)
- password_hash (VARCHAR)
- role (VARCHAR)
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)

settings:
- id (INTEGER PRIMARY KEY)
- key (VARCHAR UNIQUE)
- value (TEXT)
- updated_at (TIMESTAMP)

---

API ENDPOINTS:

GET /api/patients.php - List all patients
GET /api/patients.php?id={id} - Get patient by ID
POST /api/patients.php - Create new patient
PUT /api/patients.php?id={id} - Update patient
DELETE /api/patients.php?id={id} - Delete patient

GET /api/owners.php - List all owners
GET /api/owners.php?id={id} - Get owner by ID
POST /api/owners.php - Create new owner
PUT /api/owners.php?id={id} - Update owner
DELETE /api/owners.php?id={id} - Delete owner

GET /api/appointments.php - List appointments
GET /api/appointments.php?patient_id={id} - Get appointments for patient
POST /api/appointments.php - Create appointment
PUT /api/appointments.php?id={id} - Update appointment
DELETE /api/appointments.php?id={id} - Delete appointment

GET /api/treatments.php - List treatments
GET /api/treatments.php?patient_id={id} - Get treatments for patient
POST /api/treatments.php - Create treatment
PUT /api/treatments.php?id={id} - Update treatment
DELETE /api/treatments.php?id={id} - Delete treatment

GET /api/invoices.php - List invoices
GET /api/invoices.php?status={status} - Filter by status
POST /api/invoices.php - Create invoice
PUT /api/invoices.php?id={id} - Update invoice
DELETE /api/invoices.php?id={id} - Delete invoice

GET /api/notes.php - List notes
GET /api/notes.php?patient_id={id} - Get notes for patient
POST /api/notes.php - Create note
PUT /api/notes.php?id={id} - Update note
DELETE /api/notes.php?id={id} - Delete note

GET /api/search.php?q={query} - Global search
GET /api/stats.php - Get statistics
GET /api/settings.php - Get settings
POST /api/settings.php - Update settings

---

TECHNOLOGY STACK:

Backend:
- PHP 8.3
- SQLite/MySQL
- PDO for database access
- Twig template engine
- Composer for dependencies

Frontend:
- HTML5 semantic markup
- TailwindCSS for styling
- Alpine.js for interactivity
- Anime.js for animations
- Chart.js for data visualization
- Vanilla JavaScript for custom logic

Development:
- Git for version control
- Composer for PHP dependencies
- NPM for frontend tools (optional)
- PHPUnit for testing (planned)

---

DEPLOYMENT:

Requirements:
- PHP 8.3+
- SQLite 3.x or MySQL 5.7+
- Web server (Apache/Nginx)
- Write permissions for uploads/backups
- Composer for dependency installation

Installation:
1. Clone repository
2. Run composer install
3. Configure includes/config.php
4. Run installer/index.php
5. Set up cron for backups

---

CURRENT STATUS:
- Basic structure implemented
- Database schema created
- API endpoints functional
- Template system working
- Authentication implemented
- Patient management working
- Owner management working
- Search functionality partial
- Dashboard needs charts integration
- Invoice system needs completion
- Document upload needs fixing